{% load static %}
{% include 'navBar.html' %}

<body>
  <div class="d-flex flex-column min-vh-100">
    <header class="header-custom text-center py-4">
      <h1>üçøPel√≠culas Perfectas para Acompa√±ar tu Comidaüé¨</h1>
      <p class="lead text-secondary-emphasis">Explora una amplia selecci√≥n de pel√≠culas de todos los g√©neros.</p>
    </header>

    <main class="container my-5 flex-grow-1">

      <!-- üîç Buscador AJAX -->
      <div class="mb-4">
        <input type="text"
               class="form-control form-control-lg buscador-ajax"
               placeholder="üîç Buscar pel√≠culas por t√≠tulo o categor√≠a..."
               data-url="/peliculas/"
               data-target="contenedorPeliculas">
      </div>

      <!-- üéûÔ∏è Listado din√°mico -->
      <div id="contenedorPeliculas">
        {% if peliculas %}
          <div class="row">
            {% for pelicula in peliculas %}
              <div class="col-md-3 mb-4">
                <div class="card h-100 shadow">
                  <img src="{{ pelicula.imagen.url }}" class="card-img-top" alt="{{ pelicula.titulo }}">
                  <div class="card-body d-flex flex-column">
                    <h5 class="card-title">{{ pelicula.titulo }}</h5>
                    <p class="card-text flex-grow-1">{{ pelicula.descripcion }}</p>
                    <a href="{{ pelicula.trailer_url }}" target="_blank" class="btn btn-warning mb-2">üé¨ Ver Tr√°iler</a>

                    {% if user.is_authenticated %}
                      <form method="post" action="{% url 'toggle_favorito_pelicula' pelicula.id %}">
                        {% csrf_token %}
                        {% if pelicula in favoritos %}
                          <button type="submit" class="btn btn-danger w-100">Quitar de Favoritos ‚ù§Ô∏è</button>
                        {% else %}
                          <button type="submit" class="btn btn-outline-danger w-100">Agregar a Favoritos ü§ç</button>
                        {% endif %}
                      </form>
                    {% else %}
                      <p class="text-muted text-center mt-2">Inicia sesi√≥n para guardar en favoritos</p>
                    {% endif %}
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-center text-muted">No hay pel√≠culas disponibles por ahora.</p>
        {% endif %}
      </div>

    </main>

    {% include 'footer.html' %}
  </div>
</body>
</html>
